(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Purchase"],{"1de4":function(e,t,s){"use strict";s("700a")},"2c01":function(e,t,s){},4399:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"jd_main jd_order"},[s("HeaderBar",{attrs:{title:"确认订单",back:!0}}),s("AddressModule",{attrs:{config:e.addressConfig}}),s("section",{staticClass:"jd_shopping_list"},[s("h1",{staticClass:"jd_shopping_title"},[s("span",[e._v("关东臻品")]),1===e.type?s("span",{staticClass:"num"},[e._v("共3件")]):e._e()]),e._l(e.goodDetail.goodsList,(function(t){return s("section",{key:t.goodsId,staticClass:"jd_shopping_item"},[s("figure",{staticClass:"logo",style:{background:"url('"+t.primaryPicUrl+"') no-repeat center/cover"}}),s("article",{staticClass:"shopping-detail"},[s("h1",{staticClass:"title",domProps:{textContent:e._s(t.goodsName)}}),s("div",{staticClass:"des"},[e._v("规格：6个/份 重量： 1kg")])]),s("div",{staticClass:"price"},[e._v("￥"+e._s(t.marketPrice))]),s("div",{staticClass:"changeNum"},[s("span",{staticClass:"num"},[e._v("X "+e._s(t.number))])])])})),s("div",{staticClass:"amount"},[s("span",{staticClass:"amount-title"},[e._v("合计：")]),s("span",{staticClass:"amount-price"},[e._v("￥"+e._s(e.goodDetail.orderPrice))])])],2),e._m(0),s("section",{staticClass:"jd_order_submit"},[s("span",{staticClass:"sum"},[e._v("合计："),s("i",[e._v("￥"+e._s(e.goodDetail.orderPrice))])]),s("span",{staticClass:"buy-ok",on:{click:e.submitOrder}},[e._v("提交订单")])])],1)},n=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"jd_pay"},[s("h1",{staticClass:"jd_shopping_title"},[s("span",[e._v("支付方式")])]),s("div",{staticClass:"pay-item weChat"},[s("div",{staticClass:"pay_title"},[s("i",{staticClass:"icon"}),s("span",{staticClass:"label"},[e._v("微信")])]),s("span",{staticClass:"radio"})]),s("div",{staticClass:"pay-item aliPay selected"},[s("div",{staticClass:"pay_title"},[s("i",{staticClass:"icon"}),s("span",{staticClass:"label"},[e._v("支付宝")])]),s("span",{staticClass:"radio"})])])}],r=(s("6a61"),s("2e91")),i=s("d211"),c=s("e04f"),o=s.n(c),d=s("49c9"),u=s("cf6b"),l=s("90fe"),p=s("ce0e"),f=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"jd_address_module",on:{click:e.goAddress}},[s("div",{staticClass:"icon"}),e.config.receiverId?s("div",{staticClass:"detail"},[s("h1",{staticClass:"title"},[s("span",[e._v("收货人："+e._s(e.config.userName))]),s("span",{domProps:{textContent:e._s(e.config.mobile)}})]),s("article",{staticClass:"address-info"},[e._v("收货地址："+e._s(e.config.address))])]):e._e(),e.config.receiverId?e._e():s("div",{staticClass:"detail"},[e._v(" 暂无收货人信息，点击添加 ")]),s("div",{staticClass:"arrow"})])},v=[],g={name:"addressModule",props:{config:{default:function(){return{}},type:Object}},methods:{goAddress:function(){var e=this;e.config.receiverId?e.$router.push({path:"myAddress"}):e.$router.push({path:"address"})}}},m=g,b=(s("5694"),s("5d22")),h=Object(b["a"])(m,f,v,!1,null,"51d69356",null),_=h.exports,C={name:"sureOrder",components:{HeaderBar:p["a"],AddressModule:_},data:function(){var e=this,t=parseInt(e.$route.query.type,10),s=!Object(l["e"])(e.$route.query.pay_success),a=e.$route.query.orderSn,n=e.$route.query.id,r=o.a.get("openId");return{openId:r,type:t,id:n,orderSn:a,paySuccess:s,submitData:[],goodDetail:{},addressConfig:{}}},computed:Object(i["a"])({},Object(u["c"])(["goodsCart"])),mounted:function(){var e=this;e.checkType(),e.checkQuery()},methods:Object(i["a"])(Object(i["a"])({},Object(u["b"])(["saveGoodCart"])),{},{asyncCheckStatus:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var s,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=e,t.prev=1,t.next=4,Object(d["g"])({orderSn:s.orderSn});case 4:a=t.sent,console.log(a),5===parseInt(a.payStatus,10)&&s.$router.push({path:"buySuccess",query:{orderSn:s.orderSn}}),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](1),s.Toast(t.t0.msg||"支付状态查询失败，请在设置-反馈中联系客服");case 12:case"end":return t.stop()}}),t,null,[[1,9]])})))()},checkQuery:function(){var e=this;e.paySuccess&&e.$login().then((function(t){e.MessageBox.confirm("支付成功").then((function(t){"confirm"===t?e.checkStatus():"cancel"===t&&e.Toast("请在设置-反馈中向客服反馈")}))}))},checkStatus:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:s=e,console.log("订单号========"+s.orderSn),Object(l["e"])(s.orderSn)?s.Toast("支付参数有误"):s.asyncCheckStatus();case 3:case"end":return t.stop()}}),t)})))()},getGoodDetail:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var s,a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=e,t.prev=1,t.next=4,Object(d["D"])({previewOrderList:s.submitData});case 4:a=t.sent,n=a.rows,s.goodDetail=n,s.addressConfig={receiverId:n.receiverId,userName:n.receiverInfo,mobile:n.mobile,address:n.province+"-"+n.city+"-"+n.district+"-"+n.address},1===parseInt(s.type,10)&&s.saveGoodCart([]),console.log(s.addressConfig),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](1),console.log(t.t0.message||"获取商品数据失败");case 15:case"end":return t.stop()}}),t,null,[[1,12]])})))()},checkType:function(){var e=this;0===e.type?e.submitData=[{goodsId:e.id,goodsNum:1}]:1===e.type&&(e.submitData=e.goodsCart),e.getGoodDetail()},submitOrder:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var s,a,n,r,i,c,o,u,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=e,!s.addressConfig.receiverId){t.next=32;break}return t.prev=2,t.next=5,Object(d["J"])({receiverInfoId:s.addressConfig.receiverId,submitDetailList:s.submitData});case 5:if(a=t.sent,n=Object(l["a"])(location.href,"pay_success","success"),r=Object(l["a"])(n,"orderSn",a.rows),!a){t.next=25;break}if(console.log(a.rows),i={orderSn:a.rows,payType:Object(l["f"])()?1:4,notifyUrl:encodeURIComponent(r),openId:s.openId?s.openId:""},console.log(s.addressConfig.receiverId),!Object(l["f"])()){t.next=20;break}return t.next=15,Object(d["k"])(i);case 15:c=t.sent,o=function(){WeixinJSBridge.invoke("getBrandWCPayRequest",c,(function(e){"get_brand_wcpay_request:ok"===e.err_msg?(console.log("支付成功==="),s.paySuccess=!0,s.orderSn=i.orderSn,s.checkQuery()):"get_brand_wcpay_request:cancel"===e.err_msg?console.log("用户取消支付"):"get_brand_wcpay_request:fail"===e.err_msg&&console.log("支付失败")}))},"undefined"===typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",(function(){o()}),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",(function(){o()})),document.attachEvent("onWeixinJSBridgeReady",(function(){o()}))):o(),t.next=25;break;case 20:return t.next=22,Object(d["k"])(i);case 22:u=t.sent,p=u.url,location.href=p;case 25:t.next=30;break;case 27:t.prev=27,t.t0=t["catch"](2),s.Toast(t.t0.message||"订单提交失败");case 30:t.next=33;break;case 32:s.Toast("暂无发货地址-请添加");case 33:case"end":return t.stop()}}),t,null,[[2,27]])})))()}})},y=C,k=(s("1de4"),Object(b["a"])(y,a,n,!1,null,"303bed6a",null));t["default"]=k.exports},5694:function(e,t,s){"use strict";s("bbab")},"668b":function(e,t,s){"use strict";s("2c01")},"700a":function(e,t,s){},bbab:function(e,t,s){},ce0e:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"jd-header"},[s("span",{staticClass:"jd-header-item return-back",class:{show:e.back},on:{click:function(t){return t.stopPropagation(),e.returnBack(t)}}},[s("i")]),s("span",{staticClass:"jd-header-item",domProps:{textContent:e._s(e.title)}}),s("span",{staticClass:"jd-header-item",domProps:{textContent:e._s(e.subTitle)},on:{click:function(t){return t.stopPropagation(),e.subTitleEvent(t)}}})])},n=[],r={props:{title:{default:function(){return""},type:String},back:{default:function(){return!1},type:Boolean},subTitle:{default:function(){return""},type:String}},methods:{returnBack:function(){var e=this;e.$emit("returnOriginal"),e.$router.back(-1)},subTitleEvent:function(){var e=this;e.$emit("handleEvent")}}},i=r,c=(s("668b"),s("5d22")),o=Object(c["a"])(i,a,n,!1,null,"dbf454be",null);t["a"]=o.exports}}]);
//# sourceMappingURL=Purchase.03c2b5c5.js.map